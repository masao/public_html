<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>

  <title>Link Prefetching FAQ</title>
  <meta http-equiv="content-type"
 content="text/html; charset=EUC-JP">
<LINK REL="stylesheet" HREF="../../persistent-style.css" TYPE="text/css">
<LINK REL="icon" HREF="../../images/mozilla-16.png" TYPE="image/png">
</HEAD>
<BODY>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%">
<TR>
<TD VALIGN="TOP" class="bannercell">
<A HREF="/" CLASS="bannerlink">
<IMG SRC="../../images/mozilla-banner.gif" ALT=""
CLASS="mozillaorgbanner" WIDTH="600" HEIGHT="58">
</A>
</TD>
</TR>
</TABLE>
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
<TD VALIGN="TOP" >
<TABLE BORDER="0" class="outersidebar"><TR><TD class="bordercell" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3" class="middlesidebar"><TR><TD class="titlecell" VALIGN="TOP">
<TABLE CELLPADDING="0" CELLSPACING="3" BORDER="0" class="innersidebar">
<TR><TD class="linkcell" COLSPAN=2><A HREF="../.././"><B> mozilla.org</B></A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../why/"> Why Use Mozilla</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../feedback.html"> Feedback</A></TD></TR>
<TR><TD class="spacercell"></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="../../catalog/"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../build/"> Build It</A></TD></TR>
<TR><TD class="spacercell"></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../releases/"> Releases</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://ftp.mozilla.org/pub/mozilla/nightly/latest-trunk/"> Nightly Builds</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://bugzilla.mozilla.org/enter_bug.cgi?format=guided"> Report A Bug</A></TD></TR>
<TR><TD class="spacercell"></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://bugzilla.mozilla.org/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tinderbox</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://bonsai.mozilla.org/cvsqueryform.cgi?"> Bonsai</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="/lxr/seamonkey/"> LXR</A></TD></TR>
<TR><TD class="spacercell"></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>
<TD VALIGN="TOP">




<div style="text-align: center;"><big><big><span
 style="font-weight: bold;">Link Prefetching FAQ<br>
</span><small><small><span style="font-style: italic;">Darin Fisher /
darin at netscape dot com<br>
Updated: March 3, 2003<br>
<br>
</span></small></small></big></big>
<div style="text-align: left;">
<hr style="width: 100%; height: 2px;"><br>
<a href="#What_is_link_prefetching">What is link prefetching?</a><br>
<a href="#What_are_the_prefetching_hints">What are the prefetching
hints?</a><br>
<a href="#Are_anchor_a_tags_prefetched">Are anchor (&lt;a&gt;) tags
prefetched?</a><br>
<a href="#Is_link_prefetching_standards_compliant">Is link prefetching
standards compliant?</a><br>
<a href="#How_is_browser_idle_time_determined">How is browser idle time
determined?</a><br>
<a href="#What_happens_if_I_click_on_a_link_while">What happens if I
click on a link while something is being prefetched?</a><br>
<a href="#What_if_Im_downloading_something_in_the">What if I'm
downloading something in the background? &nbsp;Will link prefetching
compete for bandwidth?</a><br>
<a href="#Are_there_any_restrictions_on_what_is">Are there any
restrictions on what is prefetched?</a><br>
<a href="#Will_Mozilla_prefetch_documents_from_a"> Will Mozilla prefetch
documents from a different host?</a><br>
<a href="#Do_prefetched_requests_contain_a">Do prefetched requests
contain a <span style="font-family: monospace;">Referer:</span>header?</a><br>
<a href="#As_a_server_admin_can_I_distinguish">As a server admin, can I
distinguish prefetch requests from normal requests?</a><br>
<a href="#Is_there_a_preference_to_disable_link">Is there a preference
to disable link prefetching?</a><br>
<a href="#What_about_folks_who_pay-per-byte_for">What about folks who
pay-per-byte for network bandwidth?</a><br>
<a href="#Which_browsers_support_link_prefetching">Which browsers
support link prefetching?</a><br>
<a href="#What_about..._">What about...?</a><br>
<br>
<span style="font-weight: bold;"></span>
<hr style="width: 100%; height: 2px;"><span style="font-weight: bold;"></span><span
 style="font-weight: bold;"><br>
<a name="What_is_link_prefetching"></a>What is link prefetching?</span><br>
Link prefetching is a browser mechanism, which utilizes browser idle
time to download <span style="font-style: italic;">or prefetch</span>
documents that the user might visit in the near future. &nbsp;A web page
provides a set of prefetching hints to the browser, and after the
browser is finished loading the page, it begins silently prefetching
specified documents and stores them in its cache. &nbsp;When the user
visits one of the prefetched documents, it can be served up quickly out
of the browser's cache.<br>
<br>
<span style="font-weight: bold;"><a
 name="What_are_the_prefetching_hints"></a>What are the prefetching
hints?<br>
</span>The browser looks for either an HTML <span
 style="font-family: monospace;">&lt;link&gt;</span> tag or an HTTP <span
 style="font-family: monospace;">Link:</span> header with a relation
type of either <span style="font-family: monospace;">next</span> or <span
 style="font-family: monospace;">prefetch</span>. &nbsp;An example
using the <span style="font-family: monospace;">&lt;link&gt;</span> tag
follows:<br>
<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">&lt;link
rel="prefetch" href="/images/big.jpeg"&gt;<br>
</span><span style="font-family: monospace;"></span></div>
<span style="font-family: monospace;"><br>
</span>The same prefetching hint using an HTTP <span
 style="font-family: monospace;">Link:</span> header:<br>
<span style="font-family: monospace;"><br>
</span>
<div style="margin-left: 40px;"><span style="font-family: monospace;">Link:
&lt;/images/big.jpeg&gt;; rel=prefetch</span><span
 style="font-family: monospace;"></span> <span
 style="font-family: monospace;"></span><br>
<span style="font-family: monospace;"></span></div>
<span style="font-family: monospace;"> </span><span
 style="font-family: monospace;"><br>
</span>The <span style="font-family: monospace;">Link:</span> header
can also be specified within the HTML document itself by using a HTML <span
 style="font-family: monospace;">&lt;meta&gt;</span> tag:<br>
<br>
<div style="margin-left: 40px; font-family: monospace;">&lt;meta
HTTP-EQUIV="Link" CONTENT="&amp;lt;/images/big.jpeg&amp;gt;;
rel=prefetch"&gt;<br>
</div>
<br>
The format for the <span style="font-family: monospace;">Link:</span>
header is described in <a href="http://www.ietf.org/rfc/rfc2068.txt">RFC
2068</a> section 19.6.2.4.&nbsp;
(NOTE: we are intentionally referencing the out-dated HTTP/1.1 specification
here since the updated version of the standard
<a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">RFC 2616</a>
does not describe the <tt>Link:</tt>
header. &nbsp;Despite <tt>Link:</tt> headers not being part of the revised standard,
they are still used in practice by servers to specify CSS stylesheets, and so
we make use of the same facility here.)
&nbsp;The browser observes all of these hints
and queues up each unique request to be prefetched when the browser is
idle. &nbsp;There can be multiple hints per page, as it might make sense
to prefetch multiple documents.&nbsp; For example, the next document
might contain several large images.<br>
<br>
Some more examples follow:<br>
<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">&lt;link
rel="prefetch alternate stylesheet" title="Designed for Mozilla"</span><span
 style="font-family: monospace;"> href="mozspecific.css"&gt;<br>
&lt;link rel="next" href="2.html"&gt;</span><br>
<span style="font-family: monospace;"></span></div>
<br style="font-weight: bold;">
<span style="font-weight: bold;"><a name="Are_anchor_a_tags_prefetched"></a>Are
anchor (<span style="font-family: monospace;">&lt;a&gt;</span>) tags
prefetched?</span><br>
No, only <span style="font-family: monospace;">&lt;link&gt;</span> tags
w/ a relation type of <span style="font-family: monospace;">next</span>
or <span style="font-family: monospace;">prefetch</span> are prefetched.
&nbsp;However, if there is sufficient interest, we may expand link
prefetching support to include prefetching &lt;a&gt; tags, which include
a relation type of <span style="font-family: monospace;">next</span> or <span
 style="font-family: monospace;">prefetch</span> in the future.
&nbsp;Doing so would probably help content providers avoid the problem
of stale prefetching links.<br>
<br>
<span style="font-weight: bold;"><a
 name="Is_link_prefetching_standards_compliant"></a>Is link prefetching
standards compliant?</span><br>
Yes, link prefetching as outlined in this document does not violate any
existing web standards. &nbsp;In fact, the HTML 4.01 specification
explicitly allows for the definition of new link relation types (see <a
 href="http://www.w3.org/TR/html4/types.html#type-links"
 style="font-family: monospace;">http://www.w3.org/TR/html4/types.html#type-links</a>).
&nbsp;However, the exact mechanism employed by Mozilla is not yet
standardized. &nbsp;An Internet-Draft is in the works.<br>
<br>
<span style="font-weight: bold;"><a
 name="How_is_browser_idle_time_determined"></a>How is browser idle
time determined?<br>
</span>In the current implementation (Mozilla 1.2), idle time is
determined using the <span style="font-family: monospace;">nsIWebProgressListener</span>
API. &nbsp;We attach a listener to the toplevel <span
 style="font-family: monospace;">nsIWebProgress</span> object (<span
 style="font-family: monospace;">"@mozilla.org/docloaderservice;1"</span>).
&nbsp;From this, we receive document start &amp; stop notifications,
and we approximate idle time as the period between the last document
stop and the next document start. &nbsp;The last document stop
notification occurs roughly when the onLoad handler would fire for the
toplevel document. &nbsp;This is when we kick off prefetch requests.
&nbsp;If a subframe contains prefetching hints, prefetching will not
begin until the top-most frame and all its "child" frames finish loading.<br>
<br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="What_happens_if_I_click_on_a_link_while"></a>What happens if I
click on a link while something is being prefetched?<br>
</span>When the user clicks on a link, or initiates any kind of page
load, link prefetching will stop and any prefetch hints will be
discarded. &nbsp;If a prefetched document is partially downloaded, then
the partial document will still be stored in the cache provided the
server sent an "<span style="font-family: monospace;">Accept-Ranges:
bytes</span>" response header. &nbsp;This header is typically generated
by webservers when serving up static content. &nbsp;When the user visits
a prefetched document for real, the remaining portion of the document
will be fetched using a HTTP byte-range request.<br>
<br>
<span style="font-weight: bold;"><a
 name="What_if_Im_downloading_something_in_the"></a>What if I'm
downloading something in the background? &nbsp;Will link prefetching
compete for bandwidth?</span><br>
Yes and no. &nbsp;If you are downloading something using Mozilla, link
prefetching will be delayed until any background downloads complete.
&nbsp;For example, if you load a bookmark group (which opens several
tabs), any prefetch requests initiated by one of the bookmarked pages
will not begin until all of the tabs finish loading. &nbsp;If you are
using another application which uses the network, link prefetching in
Mozilla may compete for bandwidth with the other application. &nbsp;This
is a problem that we hope to address in the future by leveraging
operating system services to monitor network idle time.<br>
<br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="Are_there_any_restrictions_on_what_is"></a>Are there any
restrictions on what is prefetched?</span><br>
Yes, only http:// URLs can be prefetched (https:// URLs are never
prefetched for security reasons). &nbsp;Other protocols (such as FTP) do
not provide rich enough support for client side caching. &nbsp;In
addition to this restriction, URLs with a query string are not
prefetched. &nbsp;This is done because such URLs often result in
documents that cannot be reused out of the browser's cache, so
prefetching them often has little benefit. &nbsp;We found that some
existing sites utilize the <span style="font-family: monospace;">&lt;link
rel="next"&gt;</span> tag with URLs containing query strings to
reference the next document in a series of documents. &nbsp;Bugzilla is
an example of such a site that does this, and it turns out that the
Bugzilla bug reports are not cachable, so prefetching these URLs would
nearly double the load on poor Bugzilla! &nbsp;It's easy to imagine
other sites being designed like Bugzilla, so we explicitly do not
prefetch URLs with query strings. &nbsp;(It might make sense to allow
prefetching of these documents when the <span
 style="font-family: monospace;">rel=prefetch</span>relation type is
specified, since this should not appear in any existing content.)
&nbsp;There are no other restrictions on the URLs that are prefetched.<br>
<span style="font-weight: bold;"><br>
<a name="Will_Mozilla_prefetch_documents_from_a"></a> Will Mozilla
prefetch documents from a different host?</span><br>
Yes. &nbsp; There is no same-origin restriction for link prefetching.<span
 style="font-weight: bold;"> &nbsp;</span>Limiting prefetching to only
URLs from the the same server would not offer any increased browser
security. <span style="font-weight: bold;"><br>
</span><br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="Do_prefetched_requests_contain_a"></a>Do prefetched requests
contain a <span style="font-family: monospace;">Referer:</span>header?</span><br>
Yes, prefetched requests include a HTTP <span
 style="font-family: monospace;">Referer:</span> header indicating the
document from which the prefetching hint was extracted.<br>
<br>
This may impact referrer tracking that is commonly used on many sites.
&nbsp;For this reason, link prefetching may not be appropriate for all
content. &nbsp;However, it is possible to instruct Mozilla to validate a
prefetched document when the user follows a href to the prefetched
document by specifying the "<span style="font-family: monospace;">Cache-control:
must-revalidate</span>" HTTP response header. &nbsp;This header enables
caching, but requires an "<span style="font-family: monospace;">If-Modified-Since</span>"
or "<span style="font-family: monospace;">If-None-Match</span>"
validation request before the serving the document out of the browser's
cache.<br>
<br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="As_a_server_admin_can_I_distinguish"></a>As a server admin, can
I distinguish prefetch requests from normal requests?<br>
</span>Yes, we send the following header along with each prefetch
request:<br>
<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">X-moz:
prefetch</span></div>
<br>
Of course, this request header is not at all standardized, and it may
change in future Mozilla releases.<br>
<span style="font-weight: bold;"></span> <br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="Is_there_a_preference_to_disable_link"></a>Is there a preference
to disable link prefetching?<br>
</span>Yes, there is a hidden preference that you can set to disable
link prefetching. &nbsp;Add this line to your prefs.js file located in
your Mozilla profile directory:<br>
<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">user_pref("network.prefetch-next",
false);</span></div>
<br>
We are considering adding UI for this preference (see bug <a
 href="http://bugzilla.mozilla.org/show_bug.cgi?id=166648"
 style="text-decoration: line-through;">166648</a>); however, our
theory is that if link prefetching needs to be disabled then there must
be something wrong with the implementation. &nbsp;We would rather
improve the implementation if it does not work correctly, than simply
expect users to locate some obscure preference in the preferences UI.
&nbsp;Heck, the Mozilla preferences UI is already crowded enough ;-)<br>
<span
 style="font-style: italic; color: rgb(0, 0, 0); font-weight: bold;"><br>
Update:</span> <span style="font-style: italic;">By popular demand,
Mozilla 1.3+ includes a preference in the UI to disable
prefetching.&nbsp; See Preferences-&gt;Advanced-&gt;Cache to disable
prefetching.</span><br>
<span style="font-weight: bold;"></span><br>
<span style="font-weight: bold;"><a
 name="What_about_folks_who_pay-per-byte_for"></a>What about folks who
pay-per-byte for network bandwidth?<br>
</span> Basically, there are two ways of looking at this issue:<br>
<ol>
  <li> websites can already cause things to be silently downloaded using
JS/DOM hacks.</li>
  <li>prefetching is a browser feature; users should be able to disable
it easily. <br>
  </li>
</ol>
It is important that websites adopt <span
 style="font-family: monospace;">&lt;link&gt;</span> tag based
prefetching instead of trying to roll-in silent downloading using
various JS/DOM hacks. &nbsp;The <span style="font-family: monospace;">&lt;link&gt;</span>
tag gives the browser the ability to know what sites are up to, and we
can use this information to better prioritize document
prefetching.&nbsp; The user preference to disable <span
 style="font-family: monospace;">&lt;link&gt;</span> tag prefetching may
simply encourage websites to stick with JS/DOM hacks, and that would not
be good for users.&nbsp; This is one reason why prefetching is enabled
by default.<br>
<br>
<span
 style="font-style: italic; color: rgb(0, 0, 0); font-weight: bold;"></span><span
 style="font-weight: bold;"><a
 name="Which_browsers_support_link_prefetching"></a>Which browsers
support link prefetching?</span><br>
Browser based on Mozilla 1.2 (or later) as well as browsers based on
Mozilla 1.0.2 (or later) support prefetching.&nbsp; This includes
Netscape 7.01+ and Phoenix builds.&nbsp; Chimera builds as of March
2003 are based on Mozilla 1.0.1, and therefore do not support
prefetching.<br>
<br style="font-weight: bold;">
<span style="font-weight: bold;"><a name="What_about..._"></a>What
about...?</span><br>
If you have any questions or comments about link prefetching, please
feel free to send them my way :-) </div>
</div>



</TD>
</TR>
<TR>
<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<div class="documentinfo">
Copyright &copy; 1998-2003 The Mozilla Organization
<BR>
Last modified May 13,  2003
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/projects/netlib/Link_Prefetching_FAQ.html&amp;rev=&amp;root=/cvsroot/">Document History</A>
<BR>
<A HREF="http://doctor.mozilla.org/?file=mozilla-org/html/projects/netlib/Link_Prefetching_FAQ.html">Edit this Page</A>
(or <A HREF="/README-cvs.html">via CVS</A>)
</div>
<div align="right"><font size="-1">
訳者： 高久 雅生 &lt;<a href="mailto:masao@ulis.ac.jp">masao@ulis.ac.jp</a>&gt;<br>
<a href="http://www.mozilla.org/projects/netlib/Link_Prefetching_FAQ.html">このドキュメントのオリジナルは mozilla.org において英語で公布されています。</a><br>
またドキュメントの管理の言語は現在も英語です。この日本語訳は、<br>
利用者の利便のためにもじら組和訳プロジェクトによって提供されたものです。<br>
フィードバックは英語で、元の著者に送って下さい。<br>
翻訳された文書の一覧は、現在以下のURLで見ることが出来ます。<br>
<a href="http://www.mozilla.gr.jp/jt/index.html">http://www.mozilla.gr.jp/jt/index.html</a>
</font></div>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>
