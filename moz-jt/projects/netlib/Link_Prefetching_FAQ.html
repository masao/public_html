<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<style type="text/css">
.comment {
    color: #20A040;
    font-size: 80%;
}
.orig { font-size:80%; color:gray; }
</style>
  <title>リンクの先読み機能 FAQ</title>
  <meta http-equiv="content-type"
 content="text/html; charset=EUC-JP">
<LINK REL="stylesheet" HREF="../../persistent-style.css" TYPE="text/css">
<LINK REL="icon" HREF="../../images/mozilla-16.png" TYPE="image/png">
</HEAD>
<BODY>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%">
<TR>
<TD VALIGN="TOP" class="bannercell">
<A HREF="/" CLASS="bannerlink">
<IMG SRC="../../images/mozilla-banner.gif" ALT=""
CLASS="mozillaorgbanner" WIDTH="600" HEIGHT="58">
</A>
</TD>
</TR>
</TABLE>
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
<TD VALIGN="TOP" >
<TABLE BORDER="0" class="outersidebar"><TR><TD class="bordercell" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3" class="middlesidebar"><TR><TD class="titlecell" VALIGN="TOP">
<TABLE CELLPADDING="0" CELLSPACING="3" BORDER="0" class="innersidebar">
<TR><TD class="linkcell" COLSPAN=2><A HREF="../.././"><B> mozilla.org</B></A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../why/"> Why Use Mozilla</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../feedback.html"> Feedback</A></TD></TR>
<TR><TD class="spacercell"></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="../../catalog/"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../build/"> Build It</A></TD></TR>
<TR><TD class="spacercell"></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="../../releases/"> Releases</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://ftp.mozilla.org/pub/mozilla/nightly/latest-trunk/"> Nightly Builds</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://bugzilla.mozilla.org/enter_bug.cgi?format=guided"> Report A Bug</A></TD></TR>
<TR><TD class="spacercell"></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://bugzilla.mozilla.org/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tinderbox</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="http://bonsai.mozilla.org/cvsqueryform.cgi?"> Bonsai</A></TD></TR>
<TR><TD></TD><TD class="linkcell"><A HREF="/lxr/seamonkey/"> LXR</A></TD></TR>
<TR><TD class="spacercell"></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD class="linkcell" COLSPAN=2><A HREF="/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>
<TD VALIGN="TOP">




<div style="text-align: center;"><big><big><span
 style="font-weight: bold;">
リンクの先読み機能 FAQ<br>

</span><small><small><span style="font-style: italic;">Darin Fisher /
darin at netscape dot com<br>
2003年3月3日 更新<br>

<br>
</span></small></small></big></big>
<div style="text-align: left;">
<hr style="width: 100%; height: 2px;"><br>
<a href="#What_is_link_prefetching">リンクの先読みとは？</a><br>

<a href="#What_are_the_prefetching_hints">先読みのヒントとは？</a><br>

<a href="#Are_anchor_a_tags_prefetched">アンカータグ（&lt;a&gt;）の内容も先読みされますか？</a><br>

<a href="#Is_link_prefetching_standards_compliant">リンクの先読み機能は標準に準拠していますか？</a><br>

<a href="#How_is_browser_idle_time_determined">ブラウザのアイドル時間はどのように判定されますか？</a><br>

<a href="#What_happens_if_I_click_on_a_link_while">先読みの取得中に別のリンクをクリックするとどうなりますか？</a><br>

<a href="#What_if_Im_downloading_something_in_the">バックグラウンドで何かをダウンロードしている場合はどうですか？リンクの先読み機能は回線容量を奪い合いますか？</a><br>

<a href="#Are_there_any_restrictions_on_what_is">先読みできるものに何か制限はありますか？</a><br>

<a href="#Will_Mozilla_prefetch_documents_from_a">Mozilla は別のホストからも文書を先読みしますか？</a><br>

<a href="#Do_prefetched_requests_contain_a">先読みのリクエストには Referer: ヘッダが付きますか？</a><br>

<a href="#As_a_server_admin_can_I_distinguish">サーバ管理者ですが、先読みのリクエストを通常のリクエストと区別する方法はありますか？</a><br>

<a href="#Is_there_a_preference_to_disable_link">リンクの先読み機能を無効化する設定はありますか？</a><br>

<a href="#What_about_folks_who_pay-per-byte_for">ネットワーク回線容量の出費をバイト単位で行っている人たちについてはどうですか？</a><br>

<a href="#Which_browsers_support_link_prefetching">どのブラウザがリンクの先読み機能に対応していますか？</a><br>

<a href="#What_about..._">他には…？</a><br>

<br>
<span style="font-weight: bold;"></span>
<hr style="width: 100%; height: 2px;"><span style="font-weight: bold;"></span><span
 style="font-weight: bold;"><br>
<a name="What_is_link_prefetching"></a>
リンクの先読みとは？</span><br>

リンクの先読みとはブラウザの機能の一つで、ブラウザのアイドル時間を使って、ユーザが近い将来に訪問するであろう文書をダウンロードして、<span style="font-style: italic;">予め読み込んでおく</span>ことを指します。
まず、Web ページの方から先読みのヒントをブラウザに渡します。
そのページの読み込みが完了すると、ブラウザは黙って指定された文書を先読みし、キャッシュに蓄積しておきます。
ユーザが先読みされている文書を訪問すると、ブラウザのキャッシュからすぐに提供できます。<br>

<br>
<span style="font-weight: bold;"><a
 name="What_are_the_prefetching_hints"></a>
先読みのヒントとは？<br>

</span>
HTML の <span style="font-family: monospace;">&lt;link&gt;</span> タグまたは HTTP  の <span style="font-family: monospace;">Link:</span> ヘッダにおいて、<span style="font-family: monospace;">next</span>, <span style="font-family: monospace;">prefetch</span> のいずれかの関係を持つものです。
<span style="font-family: monospace;">&lt;link&gt;</span> タグを使う例を以下に示します。<br>

<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">&lt;link
rel="prefetch" href="/images/big.jpeg"&gt;<br>
</span><span style="font-family: monospace;"></span></div>
<span style="font-family: monospace;"><br>
</span>
同じヒントを HTTP の <span style="font-family: monospace;">Link:</span> ヘッダを使って表すと次のようになります。<br>

<span style="font-family: monospace;"><br>
</span>
<div style="margin-left: 40px;"><span style="font-family: monospace;">Link:
&lt;/images/big.jpeg&gt;; rel=prefetch</span><span
 style="font-family: monospace;"></span> <span
 style="font-family: monospace;"></span><br>
<span style="font-family: monospace;"></span></div>
<span style="font-family: monospace;"> </span><span
 style="font-family: monospace;"><br>
</span>
<span style="font-family: monospace;">Link:</span>ヘッダは HTML 文書中からも HTML の <span style="font-family: monospace;">&lt;meta&gt;</span> タグを使って指定できます。<br>

<br>
<div style="margin-left: 40px; font-family: monospace;">&lt;meta
HTTP-EQUIV="Link" CONTENT="&amp;lt;/images/big.jpeg&amp;gt;;
rel=prefetch"&gt;<br>
</div>
<br>
<span style="font-family: monospace;">Link:</span>ヘッダのフォーマットは、
<a href="http://www.ietf.org/rfc/rfc2068.txt">RFC 2068</a> の 19.6.2.4 節で説明されています。
（注意: 改訂版の標準 <a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">RFC 2616</a> には <tt>Link:</tt> ヘッダについての記述が無いため、ここではわざと改訂前の HTTP/1.1 仕様書を参照しています。
<tt>Link:</tt> ヘッダは、改訂版の標準には無いものの、実際には現在もサーバでの CSS スタイルシートの指定で使われています。そのため、我々はこの機能をここでも使うことにしました。）
ブラウザはこれらのヒント全てを元に、ブラウザが使われていない時に先読みするための各リクエストを待ち行列に入れます。
一ページに複数のヒントがあれば、複数の文書に対して先読みを行います。
例えば、次の文書としていくつかの大きな画像を指定することもあります。<br>

<br>
他にも以下のような指定ができます。<br>

<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">&lt;link
rel="prefetch alternate stylesheet" title="Designed for Mozilla"</span><span
 style="font-family: monospace;"> href="mozspecific.css"&gt;<br>
&lt;link rel="next" href="2.html"&gt;</span><br>
<span style="font-family: monospace;"></span></div>
<br style="font-weight: bold;">
<span style="font-weight: bold;"><a name="Are_anchor_a_tags_prefetched"></a>
アンカータグ（<span style="font-family: monospace;">&lt;a&gt;</span>）の内容も先読みされますか？<br>
</span>
いいえ。
<span style="font-family: monospace;">next</span> か <span style="font-family: monospace;">prefetch</span> のリンク形式を持つ <span style="font-family: monospace;">&lt;link&gt;</span> タグだけが先読みの対象です。
しかし、要望が多いようなら、<span style="font-family: monospace;">next</span> や <span style="font-family: monospace;">prefetch</span> の関係を含む &lt;a&gt; タグのリンクの先読みを将来的にはサポートするようになるかもしれません。
そうすれば、コンテンツ提供者が先読みリンクを更新し忘れるという問題を回避しやすくなるでしょう。
<br>
<br>
<span style="font-weight: bold;"><a
 name="Is_link_prefetching_standards_compliant"></a>
リンクの先読み機能は標準に準拠していますか？<br>
</span>
はい。ここで述べているリンクの先読み機能は、既存のウェブ標準に違反していません。
実際、HTML 4.01 仕様書では新たなリンク形式の定義は明確に許されています（<a
 href="http://www.w3.org/TR/html4/types.html#type-links"
 style="font-family: monospace;">http://www.w3.org/TR/html4/types.html#type-links</a> <span class="comment">[ 訳注: <a href="http://www.asahi-net.or.jp/~sd5a-ucd/rec-html401j/types.html#type-links">日本語訳</a> ]</span> 参照）。
しかし、Mozilla で採用した手法自体はまだ標準化されていません。
Internet Draft を現在準備中です。<br>
<br>
<span style="font-weight: bold;"><a
 name="How_is_browser_idle_time_determined"></a>
ブラウザのアイドル時間はどのように判定されますか？<br>

</span>
現在の実装（Mozilla 1.2）では、アイドル時間は <span style="font-family: monospace;">nsIWebProgressListener</span> API を用いて判定されます。
トップレベルの <span style="font-family: monospace;">nsIWebProgress</span> オブジェクトにリスナーを追加しました（<span style="font-family: monospace;">"@mozilla.org/docloaderservice;1"</span>）。
このリスナーから、文書の開始と停止の通知を受け取って、前の文書の停止と次の文書の開始の間の時間をアイドル時間として概算します。
前の文書の停止通知は、大まかに言って、トップレベル文書の onLoad ハンドラが起動した時に行われます。
この時が先読みリクエストを行う時になります。
サブフレームが先読みのヒントを含む場合にも、先読みは最上位のフレームとその「子」フレームの読み込みが終了するまで始まりません。<br>

<br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="What_happens_if_I_click_on_a_link_while"></a>
先読みの取得中に別のリンクをクリックするとどうなりますか？<br>

</span>
ユーザがリンクをクリックしたり、何らかの種類のページ読み込みを発生させたりすると、先読みは停止し、先読みのヒントは捨てられます。
先読みしている文書が部分的にダウンロードされている場合は、途中までの文書をサーバから送られた "<span style="font-family: monospace;">Accept-Ranges: bytes</span>" レスポンスヘッダ付きでキャッシュに蓄積されます。
このヘッダは、大抵、ウェブサーバが静的なコンテンツを提供する際に生成するものです。
ユーザが先読みした文書を実際に訪問する際には、その文書の残りの部分を HTTP の byte-range リクエストを使って取得します。
<br>

<br>
<span style="font-weight: bold;"><a
 name="What_if_Im_downloading_something_in_the"></a>
バックグラウンドで何かをダウンロードしている場合はどうですか？
リンクの先読み機能は回線容量を奪い合いますか？<br>
</span>
「イエス」であり、「ノー」でもあります。
まず、Mozilla を使って何かをダウンロードしている場合は、全てのダウンロードが終わるまでリンクの先読み機能を遅らせます。
例えば、ブックマーク・グループを読み込んでいる（複数のタブを開く）場合には、そのブックマークされたページで発生した先読みリクエストは、全てのタブがロードし終わるまで、開始されません。
一方、別のアプリケーションがネットワークを使っている場合は、Mozilla のリンクの先読みはその他のアプリケーションと回線容量を奪い合います。
将来的には、ネットワークのアイドル時間を監視するオペレーティングシステムのサービスを利用して、この問題を解決したいと思っています<br>

<br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="Are_there_any_restrictions_on_what_is"></a>
先読みできるものに何か制限はありますか？<br>
</span>
はい。http:// URL だけが先読み可能です（https:// URL はセキュリティ上の理由から先読みされません）。
（FTP などの）その他のプロトコルはクライアントサイドのキャッシュへの対応が十分でありません。
さらに、クエリ文字列 <span class="comment">[ 訳注: "http://example.org/?foo" の "?foo" のこと ] </span>付きの URLも先読みされません。
なぜなら、このような URL の多くはブラウザのキャッシュを再利用しないような文書であるため、これらの先読みは大抵役に立たないからです。
一連の文書群の中で次の文書を参照するために、<span style="font-family: monospace;">&lt;link rel="next"&gt;</span> タグにクエリ文字列付きの URL を使っている既存のサイトも現実にはあります。
Bugzilla はこのようなサイトの一例です。
Bugzilla のバグ報告などはキャッシュ可能でないため、これらの URL を先読みすると貧弱な Bugzilla の負荷を倍にしてしまうことになってしまいます!
他のサイトも Bugzilla と同様の設計になっていると容易に想像できますので、クエリ文字列付きの URL は先読みしないことにしました（ただし、<span
 style="font-family: monospace;">rel=prefetch</span> のリンク形式が指定されている文書は既存のコンテンツには存在しないと思われますので、これは先読みしてもよいかもしれません）。
先読みされる URL にその他の制限はありません。<br>

<span style="font-weight: bold;"><br>
<a name="Will_Mozilla_prefetch_documents_from_a"></a>
Mozilla は別のホストからも文書を先読みしますか？<br>
</span>
はい。
先読みには、同一生成元（same-origin）についての制限はありません。
リンクの先読みを同一サーバの URL に限定したとしても、ブラウザのセキュリティ向上にはならないでしょうから。<br>

<br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="Do_prefetched_requests_contain_a"></a>
先読みのリクエストには <span style="font-family: monospace;">Referer:</span> ヘッダが付きますか？<br>
</span>
はい。
先読みリクエストには、どの文書から先読みヒントを取ったかを示す、HTTP の <span style="font-family: monospace;">Referer:</span> ヘッダが付きます。<br>

<br>
このことは、多くのサイトで広く行われている参照元の追跡に影響するかもしれません。
このため、リンクの先読みは全てのコンテンツに対して向くものではないかもしれません。
そこで、"<span style="font-family: monospace;">Cache-control:
must-revalidate</span>" HTTP レスポンスヘッダを指定することにより、ユーザが先読みされた文書へのリンクを辿った際に、Mozilla にその先読みされた文書を検証させることができるようにしています。
このヘッダが使われると、キャッシュは有効なままですが、ブラウザのキャッシュから文書を取り出す前には、"<span style="font-family: monospace;">If-Modified-Since</span>" もしくは "<span style="font-family: monospace;">If-None-Match</span>" の検証用リクエストが必要になります。<br>

<br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="As_a_server_admin_can_I_distinguish"></a>
サーバ管理者ですが、先読みのリクエストを通常のリクエストと区別する方法はありますか？<br>

</span>
はい。
先読みのリクエストには、次のようなヘッダが付きます。<br>

<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">X-moz:
prefetch</span></div>
<br>
もちろん、このリクエストヘッダは全く標準化されていないものですので、将来の Mozilla リリースでは変更される可能性もあります。<br>

<span style="font-weight: bold;"></span> <br style="font-weight: bold;">
<span style="font-weight: bold;"><a
 name="Is_there_a_preference_to_disable_link"></a>
リンクの先読み機能を無効化する設定はありますか？<br>

</span>
はい。
リンクの先読み機能を無効化できる隠し設定があります。
Mozilla のプロファイルディレクトリにある prefs.js ファイルに次の行を追加してください。<br>

<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">user_pref("network.prefetch-next",
false);</span></div>
<br>
この設定用の UI を追加することも考慮中です（<a
 href="http://bugzilla.mozilla.org/show_bug.cgi?id=166648"
 style="text-decoration: line-through;">bug 166648</a> をご覧ください）。
しかし、リンクの先読み機能を無効にしたいという場合には、この先読みの実装に何か不具合があるのではないかと思います。
我々としては、不具合がある場合には、単にユーザに設定 UI の中から目立たない設定項目を探させるよりも、実装を改善したいと思っています。
だって、Mozilla の設定 UI はもう十分にごちゃごちゃしているんだもん。 ;-)<br>

<span
 style="font-style: italic; color: rgb(0, 0, 0); font-weight: bold;"><br>
追記:</span>
<span style="font-style: italic;">
多くの人の要望により、
Mozilla 1.3 以降の UI にリンクの先読みを無効化する設定が入りました。
リンクの先読みを無効化するには
Preferences-&gt;Advanced-&gt;Cache
<span class="comment">
[ 訳注: 日本語版では 「設定-&gt;詳細-&gt;キャッシュ」 ]
</span>
をご覧ください。
</span><br>

<span style="font-weight: bold;"></span><br>
<span style="font-weight: bold;"><a
 name="What_about_folks_who_pay-per-byte_for"></a>
ネットワーク回線容量の出費をバイト単位で行っている人たちについてはどうですか？<br>

</span>
基本的には、この問題は二つの観点から見ることができます。<br>

<ol>
  <li>ウェブサイトでは既に JavaScript や DOM といった技を使って、無断でダウンロードすることが色々と行われている。</li>
  <li>先読みはブラウザの機能の一つであり、ユーザが簡単に無効化できるようにしておくべきだ。</li>
</ol>

まず、既存のウェブサイトにおいて、JavaScript や DOM の色々な技を使って黙ってダウンロードする手法を進めていく代わりに、<span style="font-family: monospace;">&lt;link&gt;</span> タグを使った手法を採用してもらうことが重要です。
<span style="font-family: monospace;">&lt;link&gt;</span> タグにより、ブラウザはサイトの進むべき方向を知ることができます。
この情報を使うことによって、文書の先読みの優先順序をより良く付けることができます。
<span style="font-family: monospace;">&lt;link&gt;</span> タグによる先読みを無効化するユーザ設定を付けることは、単に JavaScript や DOM による技で我慢させることにつながり、ユーザにとって望ましくない結果になるかもしれません。
先読み機能がデフォルトで有効なのは、このためです。
<br>

<br>
<span
 style="font-style: italic; color: rgb(0, 0, 0); font-weight: bold;"></span><span
 style="font-weight: bold;"><a
 name="Which_browsers_support_link_prefetching"></a>
どのブラウザがリンクの先読み機能に対応していますか？<br>
</span>
Mozilla 1.2 以降ベースおよび Mozilla 1.0.2 以降ベースのブラウザが先読み機能をサポートしています。
これには Netscape 7.01 以降と Phoenix ビルドも含まれます。
2003年3月現在の Chimera ビルドは Mozilla 1.0.1 ベースですので、先読み機能に対応していません。<br>

<br style="font-weight: bold;">
<span style="font-weight: bold;"><a name="What_about..._"></a>
他には…？<br>
</span>
リンクの先読み機能について質問やコメントなどありましたら、私の方までお気軽にどうぞ。 :-)<br>
</div>
</div>



</TD>
</TR>
<TR>
<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<div class="documentinfo">
Copyright &copy; 1998-2003 The Mozilla Organization
<BR>
Last modified May 13,  2003
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/projects/netlib/Link_Prefetching_FAQ.html&amp;rev=&amp;root=/cvsroot/">Document History</A>
<BR>
<A HREF="http://doctor.mozilla.org/?file=mozilla-org/html/projects/netlib/Link_Prefetching_FAQ.html">Edit this Page</A>
(or <A HREF="/README-cvs.html">via CVS</A>)
</div>
<div align="right"><font size="-1">
訳者： 高久雅生 &lt;<a href="mailto:masao@nii.ac.jp">masao@nii.ac.jp</a>&gt;<br>
<a href="http://www.mozilla.org/projects/netlib/Link_Prefetching_FAQ.html">このドキュメントのオリジナルは mozilla.org において英語で公布されています。</a><br>
またドキュメントの管理の言語は現在も英語です。この日本語訳は、<br>
利用者の利便のためにもじら組和訳プロジェクトによって提供されたものです。<br>
フィードバックは英語で、元の著者に送って下さい。<br>
翻訳された文書の一覧は、現在以下のURLで見ることが出来ます。<br>
<a href="http://www.mozilla.gr.jp/jt/index.html">http://www.mozilla.gr.jp/jt/index.html</a>
</font></div>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>
